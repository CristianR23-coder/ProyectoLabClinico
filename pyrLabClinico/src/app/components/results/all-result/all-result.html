<!-- all-result.html -->
<section class="max-w-[1200px] mx-auto p-4">
  <header class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-3">
    <h2 class="text-2xl font-bold">Resultados</h2>

    <div class="flex items-center gap-2 flex-wrap">
      <span class="p-input-icon-left">
        <i class="pi pi-search text-gray-400 p-3"></i>
        <input pInputText type="text" placeholder="Buscar…" [(ngModel)]="globalQuery"
               (input)="dt.filterGlobal(globalQuery, 'contains')" class="w-64 max-w-full" />
      </span>

      <button pButton type="button" label="Limpiar"
              class="p-button-text !text-red-500 hover:!bg-red-50"
              (click)="clearSearch()" [disabled]="!globalQuery">
      </button>
    </div>
  </header>

  <p-table #dt [value]="results" dataKey="id" [paginator]="true" [rows]="pageSize"
           [rowsPerPageOptions]="[5,10,20,50]" [responsiveLayout]="'scroll'"
           [globalFilterFields]="globalFields" sortMode="multiple"
           [showCurrentPageReport]="true"
           currentPageReportTemplate="Mostrando {first}–{last} de {totalRecords}"
           class="rounded-xl overflow-hidden shadow-sm">

    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="ordenExamenId">Orden-Examen <p-sortIcon field="ordenExamenId"></p-sortIcon></th>
        <th>Parámetro</th>
        <th>Valor</th>
        <th>Unidad</th>
        <th>Referencia</th>
        <th>Validado</th>
        <th>Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-r>
      <tr>
        <td class="font-mono">
          {{ r.ordenExamenId }}
          <button pButton pTooltip="Ver grupo" class="p-button-text p-button-sm ml-2"
                  icon="pi pi-eye" (click)="viewGroup.emit(getGroup(r.ordenExamenId))"></button>
        </td>
        <td>{{ r.parametroId }}</td>
        <td>
          <ng-container [ngSwitch]="r.tipo">
            <span *ngSwitchCase="'num'">{{ r.valorNum }}</span>
            <span *ngSwitchCase="'texto'">{{ r.valorTexto }}</span>
            <span *ngSwitchCase="'bool'">{{ r.valorBool ? 'Positivo' : 'Negativo' }}</span>
          </ng-container>
        </td>
        <td>{{ r.unidad || '—' }}</td>
        <td>
          <span *ngIf="r.refMin!=null || r.refMax!=null">{{ r.refMin ?? '—' }} – {{ r.refMax ?? '—' }}</span>
          <span *ngIf="r.refMin==null && r.refMax==null">—</span>
        </td>
        <td><p-tag [severity]="getSeverity(r)" [value]="r.validado ? 'Sí' : 'No'"></p-tag></td>
        <td class="flex gap-2 flex-wrap">
          <button pButton pTooltip="Editar grupo" class="p-button-sm p-button-text" icon="pi pi-pencil"
                  (click)="editGroup.emit(getGroup(r.ordenExamenId))"></button>
          <button pButton pTooltip="Eliminar ítem" class="p-button-sm p-button-danger p-button-text" icon="pi pi-trash"
                  (click)="removeItem.emit(r.id)"></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr><td colspan="7" class="text-center italic text-gray-500 py-6">Sin resultados.</td></tr>
    </ng-template>
  </p-table>
</section>
