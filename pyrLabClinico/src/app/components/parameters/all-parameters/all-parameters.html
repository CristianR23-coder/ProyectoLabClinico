<!-- src/app/parameters/all-parameters/all-parameters.html -->
<div class="card p-5">
    <header class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Parámetros</h3>
        <div class="flex items-center gap-2 flex-wrap">
            <span class="p-input-icon-left">
                <i class="pi pi-search text-gray-400 p-3"></i>
                <input #q pInputText type="text" class="w-64 max-w-full"
                    placeholder="Buscar por código, nombre o unidad"
                    (input)="form.patchValue({ q: ($any($event.target).value || '') })" />
            </span>

            <button pButton type="button" label="Limpiar" class="p-button-text !text-red-500 hover:!bg-red-50"
                (click)="q.value=''; clearFilters()" [disabled]="!(q.value.length)">
            </button>

            <a pButton type="button" label="Agregar parámetro" icon="pi pi-plus" class="p-button-primary"
                (click)="openCreate()"></a>
        </div>
    </header>

    <p-table [value]="(rows$ | async) ?? []"
             dataKey="id"
             [tableStyle]="{'min-width':'56rem'}"
             [paginator]="true"
             [rows]="10"
             [rowsPerPageOptions]="[10,20,50]"
             [lazy]="false">
        <ng-template pTemplate="header">
            <tr>
                <th>Orden</th>
                <th>Código</th>
                <th>Nombre</th>
                <th>Unidad</th>
                <th>Tipo</th>
                <th class="text-right">Ref. Mín</th>
                <th class="text-right">Ref. Máx</th>
                <th class="w-36">Acciones</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-r>
            <tr>
                <td>{{ r.visualOrder ?? '—' }}</td>
                <td class="font-mono">{{ r.code || '—' }}</td>
                <td>{{ r.name }}</td>
                <td>{{ r.unit || '—' }}</td>
                <!-- ⛏️ propiedad corregida -->
                <td><p-tag [value]="r.typeValue"></p-tag></td>
                <td class="text-right">{{ r.refMin ?? '—' }}</td>
                <td class="text-right">{{ r.refMax ?? '—' }}</td>
                <td class="flex gap-2">
                    <button pButton icon="pi pi-pencil" [text]="true" [rounded]="true"
                        (click)="openEdit(r.id!)"></button>
                    <button pButton icon="pi pi-trash" [text]="true" [rounded]="true" severity="danger"
                        (click)="onDelete(r.id!)"></button>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="8" class="text-center py-6">Sin parámetros</td>
            </tr>
        </ng-template>
    </p-table>

    <!-- Dialogs -->
    <p-dialog [(visible)]="showCreate" [modal]="true" [style]="{width:'720px'}" (onHide)="showCreate=false">
        <ng-template pTemplate="header"><span class="font-bold text-xl">Nuevo parámetro</span></ng-template>
        <app-create-parameter [examenId]="examenId ?? undefined" (created)="onCreated()"
            (cancelled)="showCreate=false"></app-create-parameter>
    </p-dialog>

    <p-dialog [(visible)]="showEdit" [modal]="true" [style]="{width:'720px'}" (onHide)="showEdit=false">
        <ng-template pTemplate="header"><span class="font-bold text-xl">Editar parámetro</span></ng-template>
        <app-update-parameter *ngIf="selectedParamId!=null" [parametroId]="selectedParamId" (saved)="onSaved()"
            (cancelled)="showEdit=false"></app-update-parameter>
    </p-dialog>
</div>
