<!-- components/panels/all-panel/all-panel.html -->
<div class="card p-5">
    <header class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-bold">Paneles</h3>
        <div class="flex items-center gap-2">
            <span class="p-input-icon-left">
                <i class="pi pi-search text-gray-400 p-3"></i>
                <input pInputText type="text" class="w-64 max-w-full" placeholder="Buscar por nombre o descripción"
                    [formControl]="form.controls.q" />
            </span>

            <p-select [options]="['ACTIVO','INACTIVO']" [ngModel]="form.controls.state.value" placeholder="Estado"
                [showClear]="true" (ngModelChange)="form.patchValue({ state: $event })">
            </p-select>

            <button pButton type="button" label="Limpiar" class="p-button-text !text-red-500 hover:!bg-red-50"
                (click)="clear()" [disabled]="!(form.controls.q.value?.length || form.controls.state.value)">
            </button>

            <button pButton type="button" label="Nuevo panel" icon="pi pi-plus" class="p-button-primary"
                (click)="openCreate()"></button>
        </div>
    </header>

    <p-table [value]="(rows$ | async) ?? []" dataKey="id" [tableStyle]="{'min-width':'70rem'}">
        <ng-template pTemplate="header">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Ítems</th>
                <th>Estado</th>
                <th class="w-40">Acciones</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-r>
            <tr>
                <td>{{ r.id }}</td>
                <td class="font-semibold">{{ r.name }}</td>
                <td>{{ r.description || '—' }}</td>
                <td>{{ r.items?.length || 0 }}</td>
                <td><p-tag [value]="r.state" [severity]="tagSeverity(r.state)"></p-tag></td>
                <td class="flex gap-2">
                    <button pButton icon="pi pi-eye" [text]="true" [rounded]="true" severity="info"
                        (click)="openView(r.id!)"></button>
                    <button pButton icon="pi pi-pencil" [text]="true" [rounded]="true"
                        (click)="openEdit(r.id!)"></button>
                    <button pButton icon="pi pi-trash" [text]="true" [rounded]="true" severity="danger"
                        (click)="onDelete(r.id!)"></button>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="6" class="text-center py-6">Sin paneles</td>
            </tr>
        </ng-template>
    </p-table>

    <!-- Crear -->
    <p-dialog [(visible)]="showCreate" [modal]="true" [draggable]="false" [resizable]="false"
        [style]="{ width: '860px' }" (onHide)="closeCreate()" appendTo="body" [baseZIndex]="10000">
        <ng-template pTemplate="header"><span class="font-bold text-xl">Nuevo panel</span></ng-template>
        <app-create-panel (saved)="closeCreate()" (cancelled)="closeCreate()"></app-create-panel>
    </p-dialog>

    <!-- Editar -->
    <p-dialog [(visible)]="showEdit" [modal]="true" [style]="{width:'860px'}" (onHide)="closeEdit()" appendTo="body"
        [baseZIndex]="10000">
        <ng-template pTemplate="header"><span class="font-bold text-xl">Editar panel</span></ng-template>
        <app-update-panel *ngIf="selectedId!=null" [panelId]="selectedId" (saved)="closeEdit()"
            (cancelled)="closeEdit()"></app-update-panel>
    </p-dialog>

    <!-- Ver -->
    <p-dialog [(visible)]="showView" [modal]="true" [style]="{width:'860px'}" (onHide)="closeView()" appendTo="body"
        [baseZIndex]="10000">
        <ng-template pTemplate="header"><span class="font-bold text-xl">Detalle del panel</span></ng-template>
        <app-view-panel *ngIf="selectedId!=null" [panelId]="selectedId" (closed)="closeView()"></app-view-panel>
    </p-dialog>

</div>